defaults: &default
    resource_class: small
    docker:
        auth:
            username: _json_key
            password: $GCLOUD_GCR_BUILDER
version: 2
jobs:
    build:
        machine: true
        steps:
            - checkout
            - run: |
                docker build -t gcr.io/snyk-main/pubsubbeat:${CIRCLE_SHA1} .
    push:
        steps:
            - docker push gcr.io/snyk-main/pubsubbeat:${CIRCLE_SHA1}
workflow:
    version: 2
    build_and_push:
        jobs:
            - build
            - push